@use "sass:map";
@import "../../../node_modules/@guyn/color/dist/colors.scss";

@function contra($color, $black: black, $white: white) {
	@if lightness($color) > 60 {
		@return $black;
	} @else {
		@return $white;
	}
}
@function to-lightness($color, $lightness) {
	@return hsla(hue($color), saturation($color), $lightness, alpha($color));
}

$mobile: "screen and (max-width: 750px)";
$desktop: "screen and (min-width: 751px)";

$color-primary: $skyblue !default;
$color-secondary: $orange !default;
$color-dark: $dark-dark !default;
$color-light: $beige-light !default;
$color-white: white !default;
$color-black: black !default;

$border-radius: 0.5em !default;

$coat: () !default;

$coat-default: (
	// Colors
		color-primary: $color-primary,
	color-secondary: $color-secondary,
	color-primary-contra: contra($color-primary),
	color-secondary-contra: contra($color-secondary),
	color-dark: $color-dark,
	color-light: $color-light,
	color-white: $color-white,
	color-black: $color-black,
	// Basics
		padding: 2em,
	padding--mobile: 1em 2em,
	margin: 1em,
	transition-time: 0.3s,
	transition-bezier: ease-in-out,
	transition: 0.3s ease-in-out,
	background-color: $color-white,
	max-width: 960px,
	border-radius: $border-radius,
	border-color: $color-light,
	border-width: 1px,
	border: 1px solid $color-light,
	font-family:
		"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', 'sans-serif'",
	color: $color-dark,
	// Heading
		heading-step: 0.5,
	heading__font-family: inherit,
	// Content Links
		link__color: to-lightness($color-primary, 33),
	link__background-color: transparent,
	link__color--hover: $color-primary,
	link__background-color--hover: $color-black,
	link__border-bottom: 2px solid rgba($color-primary, 0.25),
	// List
		list-prefix__border-radius: 0,
	list-prefix__background-color: transparent,
	list-prefix__width: auto,
	list-prefix__color: to-lightness($color-primary, 30),
	// Code Examples
		code__font-family:
		"'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace",
	code__color: to-lightness($color-primary, 15),
	code__font-size: 1em,
	code__selection: $color-primary,
	code__line-height: 1,
	code__border-color: $color-light,
	code__padding: 0.5em,
	code__background-color: rgba($color-primary, 0.25),
	code__border-radius: $border-radius,
	// Code Block
		code-block__font-family:
		"'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace",
	code-block__color: $color-dark,
	code-block__font-size: 1em,
	code-block__selection: $color-primary,
	code-block__line-height: 2,
	code-block__border-color: $color-light,
	code-block__padding: 0.5em 1em,
	code-block__background-color: $color-light,
	code-block__border-radius: $border-radius,
	// Tables
		table__border-radius: 0.2em,
	table__background-color: transparent,
	table__color: currentColor,
	table__border: 1px solid $color-light,
	table-cell__padding: 0.5em 1em,
	// Header navigation
		header-nav__border: 1px solid rgba($color-black, 0.25),
	header-nav__background-color: $color-white,
	header-nav__background-color--hover: transparent,
	header-nav-link__background-color: transparent,
	header-nav-link__background-color--active: to-lightness($color-primary, 90),
	header-nav-link__color: $color-dark,
	header-nav-link__color--hover: red,
	header-nav-link__opacity: 1,
	header-nav-link__padding: 1em,
	header-nav-link__border-radius: $border-radius,
	header-nav-link-sub__background-color: to-lightness($color-secondary, 90),
	header-nav-link-sub__background-color--hover:
		to-lightness($color-secondary, 80),
	// Footer navigation
		footer-nav__border: 1px 0 0 0 solid rgba($color-black, 0.25),
	footer-nav__margin: 4em 0 0 0,
	footer-nav__border-radius: $border-radius,
	footer-nav__border-radius-mobile: $border-radius,
	footer-nav__background-color: transparent,
	footer-nav__background-color--mobile: $color-light,
	footer-nav-link__background-color: transparent,
	footer-nav-link__background-color--hover: transparent,
	footer-nav-link__background-color--active: to-lightness($color-primary, 90),
	footer-nav-link__padding: 0.5em 1em,
	footer-nav-link__padding--mobile: 1em,
	footer-nav-link__color: $color-dark,
	footer-nav-link__color--hover: to-lightness($color-primary, 33),
	footer-nav-link__color--active: contra($color-primary),
	footer-nav-link__opacity: 1,
	footer-nav-link__opacity--hover: 1,
	footer-nav-link-sub__font-size: 0.85em,
	footer-nav-link-sub__padding: 0.25em 1em,
	footer-nav-link-sub__background-color: transparent,
	footer-nav-link-sub__background-color-hover: transparent,
	footer-nav-link-sub__opacity: 0.75,
	footer-nav-link-sub__opacity--hover: 1,
	footer-nav-link-sub__opacity--active: 1,
	footer-nav-link-sub__color: currentColor,
	footer-nav-link-sub__color--hover: $color-primary,
	// Sidebar navigation
		sidebar-nav__border-radius: $border-radius,
	sidebar-nav__border-radius--mobile: $border-radius,
	sidebar-nav__background-color: $color-white,
	sidebar-nav__padding--desktop: 1em,
	sidebar-nav-mobile__background-color: $color-white,
	sidebar-nav-link__color: $color-dark,
	sidebar-nav-link__color--hover: to-lightness($color-primary, 33),
	sidebar-nav-link__opacity: 1,
	sidebar-nav-link__opacity--hover: 1,
	sidebar-nav-link__padding: 0.5em 1em,
	sidebar-nav-link__border-radius: $border-radius,
	sidebar-nav-link__background-color--active: to-lightness($color-primary, 90),
	sidebar-nav-link-sub__background-color: $color-white,
	sidebar-nav-link-sub__opacity: 0.5,
	sidebar-nav-link-sub__opacity--hover: 1,
	sidebar-nav-link-sub__opacity--active: 1,
	sidebar-nav-link-sub__color: currentColor,
	sidebar-nav-link-sub__color--hover: to-lightness($color-primary, 33),
	// Sidebar navigation
		footnote__border: 1px 0 0 0 solid $color-dark,
	footnote__opacity: 0.5,
	footnote__font-size: 0.85em,
	footnote__text-align: center,
	footnote__color: currentColor,
	footnote__padding: 2em,
	// Main section
		main__padding: 0,
	main__padding--mobile: 2em 0,
	// Overview section
		overview__margin: 4em 0 0 0,
	// Overview section
		article__max-width: 75ch,
	article__margin: 4em auto 0 auto 0,
	article__font-size: 1em,
	article__font-size-mobile: 1.25em,
	article__padding: 2em auto,
	article-paragraph__line-height: 1.75,
	article-paragraph__font-size--first: 1.25em,
	article-paragraph__line-height--first: 1.5,
	// Mobile
		mobile-nav__background-color: rgba(0, 0, 0, 0.25),
	mobile-nav__padding: 2em,
	mobile-nav__border-radius: $border-radius,
	mobile-nav-list__background-color: $color-white,
	mobile-nav-list__padding: 2em,
	mobile-nav-list__border-radius: 0.5em,
	mobile-nav-link__color: currentColor,
	mobile-nav-link__background-color: $color-white,
	mobile-nav-link__font-size: 1em,
	mobile-nav-link__opacity: 1,
	mobile-nav-link__border-radius: $border-radius,
	mobile-nav-link__padding: 0.5em 1em,
	mobile-nav-link__background-color--hover: $color-primary,
	mobile-nav-link__color--hover: contra($color-primary),
	mobile-nav-link__color--active: contra($color-primary),
	mobile-nav-link__background-color--active: $color-primary,
	mobile-nav-link__background-color--active-hover: $color-primary,
	mobile-nav-link-sub__background-color: $color-white,
	mobile-nav-link-sub__font-size: 0.85em,
	mobile-nav-link-sub__opacity: 0.5,
	mobile-nav-link-sub__padding: 0.25em 1em,
	mobile-nav-link-sub__border-radius: $border-radius,
	mobile-nav-link-sub__opacity--active: 1,
	mobile-nav-link-sub__border-radius--active: $border-radius,
	// Alert
		alert__padding: 1em,
	alert__border-radius: $border-radius,
	alert__color: $color-dark,
	alert__background-color: $color-light,
	alert__color--error: #{to-lightness($red, 12.5)},
	alert__background-color--error: #{to-lightness($red, 80)},
	alert__color--warning: #{to-lightness($orange, 12.5)},
	alert__background-color--warning: #{to-lightness($orange, 80)},
	alert__color--danger: #{to-lightness($yellow, 12.5)},
	alert__background-color--danger: #{to-lightness($yellow, 80)},
	alert__color--tip: #{to-lightness($blue, 12.5)},
	alert__background-color--tip: #{to-lightness($green, 80)},
	alert__color--success: #{to-lightness($green, 12.5)},
	alert__background-color--success: #{to-lightness($blue, 80)},
	alert__color--info: #{to-lightness($skyblue, 12.5)},
	alert__background-color--info: #{to-lightness($skyblue, 80)}
) !default;

$coat-settings: map.merge($coat-default, $coat);

@mixin setCustomProperty($setting) {
	:root {
		--coat-#{$setting}: #{map-get($coat, $setting)};
	}
}
// Function: coat-setting-exists
// Check if a Key exists in the settings
@function coat-setting-exists($setting) {
	@if map-get($coat-settings, $setting) {
		@return true;
	}
	@return false;
}
// Function: coat
// Get the value of a certain key in the settings and convert it to
// a custom property with default value or if empty just the custom property.
@function coat($setting, $prop: "", $modifier: "") {
	@if $prop != "" {
		$prop: "__#{$prop}";
	}
	@if $modifier != "" {
		$modifier: "--#{$prop}";
	}

	$key: #{$setting}#{$prop}#{$modifier};

	@if coat-setting-exists($key) {
		$value: map-get($coat-settings, $key);
		@if (str-index($key, "font-family")) {
			@return #{$value};
		} @else {
			@return unquote("var(--coat-#{$key},#{$value})");
		}
	}
	@return unquote("var(--coat-#{$setting})");
}
// Mixin: coat
// Get the setting value and check if it exists. If it exists, add the property.

@mixin coat($setting, $prop: "", $modifier: "") {
	$prop-partial: "";
	$modifier-partial: "";
	@if $prop != "" {
		$prop-partial: "__#{$prop}";
	}
	@if $modifier != "" {
		$modifier-partial: "--#{$modifier}";
	}

	$key: #{$setting}#{$prop-partial}#{$modifier-partial};

	// @debug "#{$key} ::: #{coat-setting-exists($key)} :: #{coat($key)}";
	@if coat-setting-exists($key) {
		#{$prop}: coat($key);
	}
}

// Mixin: coats
// List functionality for `mixin coat`. To do multiple properties at a time.
@mixin coats($props, $setting, $modifier: "") {
	@each $prop in $props {
		@include coat($setting, $prop, $modifier);
	}
}

@function modifier-is($setting, $modifier) {
	@if $modifier == "" {
		@if str-index($setting, "--") {
			@return false;
		}
		@return true;
	}
	@if str-index($setting, "--#{$modifier}") {
		@return true;
	} @else {
		@return false;
	}
}
@function get-prop($setting) {
	@if str-index($setting, "__") {
		$start: str-index($setting, "__");
		$end: str-length($setting);
		@if str-index($setting, "--") {
			$end: str-index($setting, "--") - 1;
		}
		@return str-slice($setting, $start + 2, $end);
	} @else {
		@return null;
	}
}

@mixin coat-auto($setting, $modifier: "") {
	@each $setting-key, $setting-value in $coat-settings {
		@if modifier-is($setting-key, $modifier) and
			str-index($setting-key, $setting + "__")
		{
			$prop: get-prop($setting-key);

			@if $prop != null or $prop != "" and $setting-value {
				#{$prop}: coat($setting-key);
			}
		}
	}
}
